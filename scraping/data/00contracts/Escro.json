[{"SourceCode":"// // SPDX-License-Identifier: MIT\r\n\r\npragma solidity ^0.8.15 ;\r\n\r\ncontract Ownable {\r\n\r\n    address payable public owner;\r\n\r\n    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);\r\n\r\n    constructor() {\r\n        owner = payable(msg.sender);\r\n    }\r\n\r\n    modifier isOwner() {\r\n        require(msg.sender == owner);\r\n        _;\r\n    }\r\n\r\n    function transferOwnership(address payable newOwner) public isOwner {\r\n        require(newOwner != address(0));\r\n        emit OwnershipTransferred(owner, newOwner);\r\n        owner = newOwner;\r\n    }\r\n\r\n}\r\n\r\ncontract Escrow is Ownable{\r\n\r\n    uint public id = 1;\r\n\r\n    struct productInfo{\r\n        uint productId;\r\n        address seller;\r\n        string productName;\r\n        string productDescription;\r\n        string productCategory;\r\n        uint price;\r\n        string productImageURL;\r\n        string sellerEmail;\r\n        bool hasPurchased;\r\n        uint256 timestamp;\r\n    }\r\n\r\n    struct cartInfo{\r\n        uint productId;\r\n        address sellerAddress;\r\n        address buyerAddress;\r\n        string productName;\r\n        string productDescription;\r\n        uint price;\r\n        string productImageURL;\r\n        string sellerEmail;\r\n        uint timeToRevert;\r\n        uint256 timestamp;\r\n    }\r\n\r\n    mapping(address => mapping(uint => uint)) public payment;\r\n    mapping(address => mapping(uint => bool)) public isPaymentDone;\r\n    \r\n    productInfo[] product;\r\n    cartInfo[] public cart;\r\n\r\n    function addToBlockchain(string memory _productName, string memory _productDescription, string memory _productCategory, uint _price, string memory _productImageURL, string memory _sellerEmail) external{\r\n\r\n        product.push(productInfo(id, msg.sender, _productName, _productDescription, _productCategory, _price, _productImageURL, _sellerEmail, false, block.timestamp));\r\n        id++;\r\n    } \r\n\r\n    function getAllProdcuts() external view returns(productInfo[] memory){\r\n        return product;\r\n    }\r\n\r\n    function addToCart(uint _id, string memory _productName, string memory _productDescription, uint _price, string memory _productImageURL, string memory _sellerEmail, address _sellerAddress, uint _timeToRevert) payable external {\r\n        cart.push(cartInfo(_id, _sellerAddress, msg.sender, _productName, _productDescription, _price, _productImageURL, _sellerEmail , _timeToRevert, block.timestamp));\r\n        \r\n        updateShop(_id);\r\n\r\n        payment[msg.sender][_id] = _price;\r\n    }\r\n\r\n    function reteriveCart() external view returns(cartInfo[] memory){\r\n        return cart; \r\n    }\r\n\r\n    function removeFromCart(uint _id) public {\r\n        uint index;\r\n\r\n        for(uint i=0; i < cart.length; i++){\r\n            if(cart[i].productId == _id ){\r\n                index = i;\r\n\r\n                break;\r\n            }\r\n        }\r\n\r\n        for(uint i=index; i < cart.length -1; i++){\r\n            cart[i] = cart[i+1];\r\n        }\r\n\r\n        \r\n        cart.pop();\r\n        // delete cart[index];\r\n    }\r\n\r\n    function deleteCard(uint _id) public {\r\n        uint index;\r\n\r\n        for(uint i=0; i < product.length; i++){\r\n            if(product[i].productId  == _id){\r\n                index = i;\r\n\r\n                break;\r\n            }\r\n        }\r\n\r\n        for(uint i=index; i < product.length -1; i++){\r\n            product[i] = product[i+1];\r\n        }\r\n\r\n        product.pop();\r\n    }\r\n\r\n    function updateShop(uint _id) public {\r\n        uint index;\r\n        \r\n        for(uint i=0; i < product.length; i++){\r\n            if(product[i].productId == _id){\r\n                index = i;\r\n                // return;\r\n            }\r\n        }\r\n\r\n        product[index].hasPurchased = true;\r\n    }\r\n\r\n    function getDeposits(address buyerAddress, uint _id) view public returns(uint amount, bool done){\r\n        amount = payment[buyerAddress][_id];\r\n        \r\n        done = isPaymentDone[buyerAddress][_id];\r\n\r\n        return (amount, done);\r\n    }\r\n\r\n    function transferToSeller(uint _id, address payable sellerAddress, address buyerAddress) external {\r\n        uint amount = payment[buyerAddress][_id];\r\n        uint fee = amount * 93 / 100;\r\n        uint sellerAmount = amount - fee;\r\n        \r\n        owner.transfer(fee);\r\n        sellerAddress.transfer(sellerAmount);\r\n        \r\n        // payment[msg.sender][sellerAddress] = 0;\r\n        isPaymentDone[buyerAddress][_id] = true;\r\n        \r\n        removeFromCart(_id);\r\n        deleteCard(_id);\r\n\r\n    }\r\n\r\n    function transferToBuyer(uint _id, address payable buyerAddress) external {\r\n        uint amount = payment[buyerAddress][_id];\r\n\r\n        buyerAddress.transfer(amount);\r\n\r\n        isPaymentDone[buyerAddress][_id] = true;\r\n\r\n        removeFromCart(_id);\r\n        deleteCard(_id);\r\n    }\r\n\r\n    function contractAmount() view external returns(uint) {\r\n        return address(this).balance;\r\n    }\r\n\r\n    function getSenderAddress() view external returns(address){\r\n        return msg.sender;\r\n    }\r\n\r\n    // function confirm() public {\r\n        \r\n    // }\r\n}","ABI":"[{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"previousOwner\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"},{\"inputs\":[{\"internalType\":\"string\",\"name\":\"_productName\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_productDescription\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_productCategory\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"_price\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"_productImageURL\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_sellerEmail\",\"type\":\"string\"}],\"name\":\"addToBlockchain\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_id\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"_productName\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_productDescription\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"_price\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"_productImageURL\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"_sellerEmail\",\"type\":\"string\"},{\"internalType\":\"address\",\"name\":\"_sellerAddress\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_timeToRevert\",\"type\":\"uint256\"}],\"name\":\"addToCart\",\"outputs\":[],\"stateMutability\":\"payable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"cart\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"productId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"sellerAddress\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"buyerAddress\",\"type\":\"address\"},{\"internalType\":\"string\",\"name\":\"productName\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"productDescription\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"price\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"productImageURL\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"sellerEmail\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"timeToRevert\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"timestamp\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"contractAmount\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_id\",\"type\":\"uint256\"}],\"name\":\"deleteCard\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getAllProdcuts\",\"outputs\":[{\"components\":[{\"internalType\":\"uint256\",\"name\":\"productId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"internalType\":\"string\",\"name\":\"productName\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"productDescription\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"productCategory\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"price\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"productImageURL\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"sellerEmail\",\"type\":\"string\"},{\"internalType\":\"bool\",\"name\":\"hasPurchased\",\"type\":\"bool\"},{\"internalType\":\"uint256\",\"name\":\"timestamp\",\"type\":\"uint256\"}],\"internalType\":\"struct Escrow.productInfo[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"buyerAddress\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_id\",\"type\":\"uint256\"}],\"name\":\"getDeposits\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"done\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"getSenderAddress\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"id\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"isPaymentDone\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address payable\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"payment\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_id\",\"type\":\"uint256\"}],\"name\":\"removeFromCart\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"reteriveCart\",\"outputs\":[{\"components\":[{\"internalType\":\"uint256\",\"name\":\"productId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"sellerAddress\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"buyerAddress\",\"type\":\"address\"},{\"internalType\":\"string\",\"name\":\"productName\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"productDescription\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"price\",\"type\":\"uint256\"},{\"internalType\":\"string\",\"name\":\"productImageURL\",\"type\":\"string\"},{\"internalType\":\"string\",\"name\":\"sellerEmail\",\"type\":\"string\"},{\"internalType\":\"uint256\",\"name\":\"timeToRevert\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"timestamp\",\"type\":\"uint256\"}],\"internalType\":\"struct Escrow.cartInfo[]\",\"name\":\"\",\"type\":\"tuple[]\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address payable\",\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"transferOwnership\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_id\",\"type\":\"uint256\"},{\"internalType\":\"address payable\",\"name\":\"buyerAddress\",\"type\":\"address\"}],\"name\":\"transferToBuyer\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_id\",\"type\":\"uint256\"},{\"internalType\":\"address payable\",\"name\":\"sellerAddress\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"buyerAddress\",\"type\":\"address\"}],\"name\":\"transferToSeller\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_id\",\"type\":\"uint256\"}],\"name\":\"updateShop\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]","ContractName":"Escrow","CompilerVersion":"v0.8.15+commit.e14f2714","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","EVMVersion":"Default","Library":"","LicenseType":"MIT","Proxy":"0","Implementation":"","SwarmSource":"ipfs://8c898ed14974ea4f769366f9c28ee64230d3dc5f9cf1b61919d35a6ddec43412"}]