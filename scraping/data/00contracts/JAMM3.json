[{"SourceCode":"pragma solidity ^0.5.17;\r\n\r\ninterface Callable {\r\n\tfunction tokenCallback(address _from, uint256 _tokens, bytes calldata _data) external returns (bool);\r\n}\r\n\r\ninterface JAM {\r\n\tfunction balanceOf(address) external view returns (uint256);\r\n\tfunction allowance(address, address) external view returns (uint256);\r\n\tfunction transfer(address, uint256) external returns (bool);\r\n\tfunction transferFrom(address, address, uint256) external returns (bool);\r\n}\r\n\r\ncontract JAMM3D {\r\n\r\n\tuint256 constant private FLOAT_SCALAR = 2**64;\r\n\r\n\tuint256 constant private BUY_TAX = 4;\r\n\tuint256 constant private SELL_TAX = 4;\r\n\tuint256 constant private REINVEST_TAX = 2;\r\n\r\n\tuint256 constant private STARTING_PRICE = 1 * 10**9;\r\n\tuint256 constant private INCREMENT = 0.001 * 10**9;\r\n\r\n\tstring constant public name = \"JAMM3D\";\r\n\tstring constant public symbol = \"JAMM3D\";\r\n\tuint8 constant public decimals = 18;\r\n\r\n\tstruct User {\r\n\t\tuint256 balance;\r\n\t\tmapping(address => uint256) allowance;\r\n\t\tint256 scaledPayout;\r\n\t}\r\n\r\n\tstruct Info {\r\n\t\tuint256 totalSupply;\r\n\t\tmapping(address => User) users;\r\n\t\tuint256 scaledJAMPerToken;\r\n\t\tJAM jam;\r\n\t}\r\n\r\n\tInfo private info;\r\n\r\n\tevent Transfer(address indexed from, address indexed to, uint256 tokens);\r\n\tevent Approval(address indexed owner, address indexed spender, uint256 tokens);\r\n\tevent Buy(address indexed buyer, uint256 amountSpent, uint256 tokensReceived);\r\n\tevent Sell(address indexed seller, uint256 tokensSpent, uint256 amountReceived);\r\n\tevent Withdraw(address indexed user, uint256 amount);\r\n\tevent Reinvest(address indexed user, uint256 amount);\r\n\r\n\tconstructor(address _JAM_address) public {\r\n\t\tinfo.jam = JAM(_JAM_address);\r\n\t}\r\n\r\n\tfunction buy(uint256 _amount) external returns (uint256) {\r\n\t\trequire(_amount > 0);\r\n\t\trequire(info.jam.transferFrom(msg.sender, address(this), _amount));\r\n\t\treturn _buy(_amount);\r\n\t}\r\n\r\n\tfunction sell(uint256 _tokens) external returns (uint256) {\r\n\t\trequire(balanceOf(msg.sender) >= _tokens);\r\n\t\treturn _sell(_tokens);\r\n\t}\r\n\r\n\tfunction withdraw() external returns (uint256) {\r\n\t\tuint256 _dividends = dividendsOf(msg.sender);\r\n\t\trequire(_dividends > 0);\r\n\t\tinfo.users[msg.sender].scaledPayout += int256(_dividends * FLOAT_SCALAR);\r\n\t\tinfo.jam.transfer(msg.sender, _dividends);\r\n\t\temit Withdraw(msg.sender, _dividends);\r\n\t\treturn _dividends;\r\n\t}\r\n\r\n\tfunction reinvest() external returns (uint256) {\r\n\t\tuint256 _dividends = dividendsOf(msg.sender);\r\n\t\trequire(_dividends > 0);\r\n\t\tinfo.users[msg.sender].scaledPayout += int256(_dividends * FLOAT_SCALAR);\r\n\t\temit Reinvest(msg.sender, _dividends);\r\n\t\treturn _reinvest(_dividends);\r\n\t}\r\n\r\n\tfunction transfer(address _to, uint256 _tokens) external returns (bool) {\r\n\t\treturn _transfer(msg.sender, _to, _tokens);\r\n\t}\r\n\r\n\tfunction approve(address _spender, uint256 _tokens) external returns (bool) {\r\n\t\tinfo.users[msg.sender].allowance[_spender] = _tokens;\r\n\t\temit Approval(msg.sender, _spender, _tokens);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction transferFrom(address _from, address _to, uint256 _tokens) external returns (bool) {\r\n\t\trequire(info.users[_from].allowance[msg.sender] >= _tokens);\r\n\t\tinfo.users[_from].allowance[msg.sender] -= _tokens;\r\n\t\treturn _transfer(_from, _to, _tokens);\r\n\t}\r\n\r\n\tfunction transferAndCall(address _to, uint256 _tokens, bytes calldata _data) external returns (bool) {\r\n\t\t_transfer(msg.sender, _to, _tokens);\r\n\t\tuint32 _size;\r\n\t\tassembly {\r\n\t\t\t_size := extcodesize(_to)\r\n\t\t}\r\n\t\tif (_size > 0) {\r\n\t\t\trequire(Callable(_to).tokenCallback(msg.sender, _tokens, _data));\r\n\t\t}\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction totalSupply() public view returns (uint256) {\r\n\t\treturn info.totalSupply;\r\n\t}\r\n\r\n\tfunction currentPrices() public view returns (uint256 truePrice, uint256 buyPrice, uint256 sellPrice) {\r\n\t\ttruePrice = STARTING_PRICE + INCREMENT * totalSupply() / 1e18;\r\n\t\tbuyPrice = truePrice * 100 / (100 - BUY_TAX);\r\n\t\tsellPrice = truePrice * (100 - SELL_TAX) / 100;\r\n\t}\r\n\r\n\tfunction balanceOf(address _user) public view returns (uint256) {\r\n\t\treturn info.users[_user].balance;\r\n\t}\r\n\r\n\tfunction dividendsOf(address _user) public view returns (uint256) {\r\n\t\treturn uint256(int256(info.scaledJAMPerToken * balanceOf(_user)) - info.users[_user].scaledPayout) / FLOAT_SCALAR;\r\n\t}\r\n\r\n\tfunction allInfoFor(address _user) public view returns (uint256 contractBalance, uint256 totalTokenSupply, uint256 truePrice, uint256 buyPrice, uint256 sellPrice, uint256 userJAM, uint256 userAllowance, uint256 userBalance, uint256 userDividends, uint256 userLiquidValue) {\r\n\t\tcontractBalance = info.jam.balanceOf(address(this));\r\n\t\ttotalTokenSupply = totalSupply();\r\n\t\t(truePrice, buyPrice, sellPrice) = currentPrices();\r\n\t\tuserJAM = info.jam.balanceOf(_user);\r\n\t\tuserAllowance = info.jam.allowance(_user, address(this));\r\n\t\tuserBalance = balanceOf(_user);\r\n\t\tuserDividends = dividendsOf(_user);\r\n\t\tuserLiquidValue = calculateResult(userBalance, false, false) + userDividends;\r\n\t}\r\n\r\n\tfunction allowance(address _user, address _spender) public view returns (uint256) {\r\n\t\treturn info.users[_user].allowance[_spender];\r\n\t}\r\n\r\n\tfunction calculateResult(uint256 _amount, bool _buy, bool _inverse) public view returns (uint256) {\r\n\t\tuint256 _buyPrice;\r\n\t\tuint256 _sellPrice;\r\n\t\t( , _buyPrice, _sellPrice) = currentPrices();\r\n\t\tuint256 _rate = (_buy ? _buyPrice : _sellPrice);\r\n\t\tuint256 _increment = INCREMENT * (_buy ? 100 : (100 - SELL_TAX)) / (_buy ? (100 - BUY_TAX) : 100);\r\n\t\tif ((_buy && !_inverse) || (!_buy && _inverse)) {\r\n\t\t\tif (_inverse) {\r\n\t\t\t\treturn (2 * _rate - _sqrt(4 * _rate * _rate + _increment * _increment - 4 * _rate * _increment - 8 * _amount * _increment) - _increment) * 1e18 / (2 * _increment);\r\n\t\t\t} else {\r\n\t\t\t\treturn (_sqrt((_increment + 2 * _rate) * (_increment + 2 * _rate) + 8 * _amount * _increment) - _increment - 2 * _rate) * 1e18 / (2 * _increment);\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tif (_inverse) {\r\n\t\t\t\treturn (_rate * _amount + (_increment * (_amount + 1e18) / 2e18) * _amount) / 1e18;\r\n\t\t\t} else {\r\n\t\t\t\treturn (_rate * _amount - (_increment * (_amount + 1e18) / 2e18) * _amount) / 1e18;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tfunction _transfer(address _from, address _to, uint256 _tokens) internal returns (bool) {\r\n\t\trequire(info.users[_from].balance >= _tokens);\r\n\t\tinfo.users[_from].balance -= _tokens;\r\n\t\tinfo.users[_from].scaledPayout -= int256(_tokens * info.scaledJAMPerToken);\r\n\t\tinfo.users[_to].balance += _tokens;\r\n\t\tinfo.users[_to].scaledPayout += int256(_tokens * info.scaledJAMPerToken);\r\n\t\temit Transfer(_from, _to, _tokens);\r\n\t\treturn true;\r\n\t}\r\n\r\n\tfunction _buy(uint256 _amount) internal returns (uint256 tokens) {\r\n\t\tuint256 _tax = _amount * BUY_TAX / 100;\r\n\t\ttokens = calculateResult(_amount, true, false);\r\n\t\tinfo.totalSupply += tokens;\r\n\t\tinfo.users[msg.sender].balance += tokens;\r\n\t\tinfo.users[msg.sender].scaledPayout += int256(tokens * info.scaledJAMPerToken);\r\n\t\tinfo.scaledJAMPerToken += _tax * FLOAT_SCALAR / info.totalSupply;\r\n\t\temit Transfer(address(0x0), msg.sender, tokens);\r\n\t\temit Buy(msg.sender, _amount, tokens);\r\n\t}\r\n\r\n\tfunction _reinvest(uint256 _amount) internal returns (uint256 tokens) {\r\n\t\tuint256 _tax = _amount * REINVEST_TAX / 100;\r\n\t\ttokens = calculateResult(_amount, true, false);\r\n\t\tinfo.totalSupply += tokens;\r\n\t\tinfo.users[msg.sender].balance += tokens;\r\n\t\tinfo.users[msg.sender].scaledPayout += int256(tokens * info.scaledJAMPerToken);\r\n\t\tinfo.scaledJAMPerToken += _tax * FLOAT_SCALAR / info.totalSupply;\r\n\t\temit Transfer(address(0x0), msg.sender, tokens);\r\n\t\temit Buy(msg.sender, _amount, tokens);\r\n\t}\r\n\r\n\tfunction _sell(uint256 _tokens) internal returns (uint256 amount) {\r\n\t\trequire(info.users[msg.sender].balance >= _tokens);\r\n\t\tamount = calculateResult(_tokens, false, false);\r\n\t\tuint256 _tax = amount * SELL_TAX / (100 - SELL_TAX);\r\n\t\tinfo.totalSupply -= _tokens;\r\n\t\tinfo.users[msg.sender].balance -= _tokens;\r\n\t\tinfo.users[msg.sender].scaledPayout -= int256(_tokens * info.scaledJAMPerToken);\r\n\t\tinfo.scaledJAMPerToken += _tax * FLOAT_SCALAR / info.totalSupply;\r\n\t\tinfo.jam.transfer(msg.sender, amount);\r\n\t\temit Transfer(msg.sender, address(0x0), _tokens);\r\n\t\temit Sell(msg.sender, _tokens, amount);\r\n\t}\r\n\r\n\tfunction _sqrt(uint256 _n) internal pure returns (uint256 result) {\r\n\t\tuint256 _tmp = (_n + 1) / 2;\r\n\t\tresult = _n;\r\n\t\twhile (_tmp < result) {\r\n\t\t\tresult = _tmp;\r\n\t\t\t_tmp = (_n / _tmp + _tmp) / 2;\r\n\t\t}\r\n\t}\r\n}","ABI":"[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"_JAM_address\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"spender\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"tokens\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"buyer\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amountSpent\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"tokensReceived\",\"type\":\"uint256\"}],\"name\":\"Buy\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"user\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"Reinvest\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"seller\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"tokensSpent\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amountReceived\",\"type\":\"uint256\"}],\"name\":\"Sell\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"tokens\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"user\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"Withdraw\",\"type\":\"event\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_user\",\"type\":\"address\"}],\"name\":\"allInfoFor\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"contractBalance\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"totalTokenSupply\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"truePrice\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"buyPrice\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"sellPrice\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"userJAM\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"userAllowance\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"userBalance\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"userDividends\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"userLiquidValue\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_user\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"_spender\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_spender\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_tokens\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_user\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"}],\"name\":\"buy\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_amount\",\"type\":\"uint256\"},{\"internalType\":\"bool\",\"name\":\"_buy\",\"type\":\"bool\"},{\"internalType\":\"bool\",\"name\":\"_inverse\",\"type\":\"bool\"}],\"name\":\"calculateResult\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"currentPrices\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"truePrice\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"buyPrice\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"sellPrice\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"internalType\":\"uint8\",\"name\":\"\",\"type\":\"uint8\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_user\",\"type\":\"address\"}],\"name\":\"dividendsOf\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"reinvest\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"_tokens\",\"type\":\"uint256\"}],\"name\":\"sell\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_tokens\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_tokens\",\"type\":\"uint256\"},{\"internalType\":\"bytes\",\"name\":\"_data\",\"type\":\"bytes\"}],\"name\":\"transferAndCall\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"internalType\":\"address\",\"name\":\"_from\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"_to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"_tokens\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"withdraw\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"}]","ContractName":"JAMM3D","CompilerVersion":"v0.5.17+commit.d19bba13","OptimizationUsed":"0","Runs":"200","ConstructorArguments":"0000000000000000000000009fb9ec13a18eff7072ee8ca7ee7a2b295649e00d","EVMVersion":"Default","Library":"","LicenseType":"None","Proxy":"0","Implementation":"","SwarmSource":"bzzr://af4fefa893bac33f398e6fc692819b5725eb221e1b29282632c3f7e40113bdf7"}]