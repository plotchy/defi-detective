[{"SourceCode":"pragma solidity ^0.4.23;\r\n\r\n// File: contracts/utilities/UpgradeHelper.sol\r\n\r\ncontract OldTrueUSDInterface {\r\n    function delegateToNewContract(address _newContract) public;\r\n    function claimOwnership() public;\r\n    function balances() public returns(address);\r\n    function allowances() public returns(address);\r\n    function totalSupply() public returns(uint);\r\n    function transferOwnership(address _newOwner) external;\r\n}\r\ncontract NewTrueUSDInterface {\r\n    function setTotalSupply(uint _totalSupply) public;\r\n    function transferOwnership(address _newOwner) public;\r\n    function claimOwnership() public;\r\n}\r\n\r\ncontract TokenControllerInterface {\r\n    function claimOwnership() external;\r\n    function transferChild(address _child, address _newOwner) external;\r\n    function requestReclaimContract(address _child) external;\r\n    function issueClaimOwnership(address _child) external;\r\n    function setTrueUSD(address _newTusd) external;\r\n    function setTusdRegistry(address _Registry) external;\r\n    function claimStorageForProxy(address _delegate,\r\n        address _balanceSheet,\r\n        address _alowanceSheet) external;\r\n    function setGlobalPause(address _globalPause) external;\r\n    function transferOwnership(address _newOwner) external;\r\n    function owner() external returns(address);\r\n}\r\n\r\n/**\r\n */\r\ncontract UpgradeHelper {\r\n    OldTrueUSDInterface public constant oldTrueUSD = OldTrueUSDInterface(0x8dd5fbCe2F6a956C3022bA3663759011Dd51e73E);\r\n    NewTrueUSDInterface public constant newTrueUSD = NewTrueUSDInterface(0x0000000000085d4780B73119b644AE5ecd22b376);\r\n    TokenControllerInterface public constant tokenController = TokenControllerInterface(0x0000000000075EfBeE23fe2de1bd0b7690883cc9);\r\n    address public constant registry = address(0x0000000000013949F288172bD7E36837bDdC7211);\r\n    address public constant globalPause = address(0x0000000000027f6D87be8Ade118d9ee56767d993);\r\n\r\n    function upgrade() public {\r\n        // TokenController should have end owner as it's pending owner at the end\r\n        address endOwner = tokenController.owner();\r\n\r\n        // Helper contract becomes the owner of controller, and both TUSD contracts\r\n        tokenController.claimOwnership();\r\n        newTrueUSD.claimOwnership();\r\n\r\n        // Initialize TrueUSD totalSupply\r\n        newTrueUSD.setTotalSupply(oldTrueUSD.totalSupply());\r\n\r\n        // Claim storage contract from oldTrueUSD\r\n        address balanceSheetAddress = oldTrueUSD.balances();\r\n        address allowanceSheetAddress = oldTrueUSD.allowances();\r\n        tokenController.requestReclaimContract(balanceSheetAddress);\r\n        tokenController.requestReclaimContract(allowanceSheetAddress);\r\n\r\n        // Transfer storage contract to controller then transfer it to NewTrueUSD\r\n        tokenController.issueClaimOwnership(balanceSheetAddress);\r\n        tokenController.issueClaimOwnership(allowanceSheetAddress);\r\n        tokenController.transferChild(balanceSheetAddress, newTrueUSD);\r\n        tokenController.transferChild(allowanceSheetAddress, newTrueUSD);\r\n        \r\n        newTrueUSD.transferOwnership(tokenController);\r\n        tokenController.issueClaimOwnership(newTrueUSD);\r\n        tokenController.setTrueUSD(newTrueUSD);\r\n        tokenController.claimStorageForProxy(newTrueUSD, balanceSheetAddress, allowanceSheetAddress);\r\n\r\n        // Configure TrueUSD\r\n        tokenController.setTusdRegistry(registry);\r\n        tokenController.setGlobalPause(globalPause);\r\n\r\n        // Point oldTrueUSD delegation to NewTrueUSD\r\n        tokenController.transferChild(oldTrueUSD, address(this));\r\n        oldTrueUSD.claimOwnership();\r\n        oldTrueUSD.delegateToNewContract(newTrueUSD);\r\n        \r\n        // Controller owns both old and new TrueUSD\r\n        oldTrueUSD.transferOwnership(tokenController);\r\n        tokenController.issueClaimOwnership(oldTrueUSD);\r\n        tokenController.transferOwnership(endOwner);\r\n    }\r\n}","ABI":"[{\"constant\":true,\"inputs\":[],\"name\":\"oldTrueUSD\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"registry\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"newTrueUSD\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"upgrade\",\"outputs\":[],\"payable\":false,\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"tokenController\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"globalPause\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"stateMutability\":\"view\",\"type\":\"function\"}]","ContractName":"UpgradeHelper","CompilerVersion":"v0.4.23+commit.124ca40d","OptimizationUsed":"1","Runs":"200","ConstructorArguments":"","EVMVersion":"Default","Library":"","LicenseType":"","Proxy":"0","Implementation":"","SwarmSource":"bzzr://2a59e33c10cc71b3385f56728201fb899b92430c973a99a435f064d0adb33f29"}]